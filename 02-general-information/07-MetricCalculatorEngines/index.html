
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://raiffeisen-dgtl.github.io/checkita-data-quality/02-general-information/07-MetricCalculatorEngines/" rel="canonical"/>
<link href="../06-MetricSQLEquivalency/" rel="prev"/>
<link href="../08-CheckFailureTolerance/" rel="next"/>
<link href="../../logo/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.49" name="generator"/>
<title>Metric Calculator Engines Overview and Benchmarking - Checkita Data Quality</title>
<link href="../../assets/stylesheets/main.6f8fc17f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="yellow" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#metric-calculator-engines-overview-and-benchmarking">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Checkita Data Quality" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Checkita Data Quality">
<img alt="logo" src="../../logo/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Checkita Data Quality
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Metric Calculator Engines Overview and Benchmarking
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/Raiffeisen-DGTL/checkita-data-quality" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    checkita-data-quality
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../01-application-setup/">
          
  
    
  
  Application Setup

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
    
  
  General Information

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../03-job-configuration/">
          
  
    
  
  Job Configuration

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../changelog/CHANGELOG/">
        
  
    
  
  Changelog

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../contribution/">
          
  
    
  
  Contribution

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../api/">
        
  
    
  
  Scala API Doc

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../swagger/">
        
  
    
  
  Swagger Doc

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Checkita Data Quality" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Checkita Data Quality">
<img alt="logo" src="../../logo/logo.png"/>
</a>
    Checkita Data Quality
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/Raiffeisen-DGTL/checkita-data-quality" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    checkita-data-quality
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../01-application-setup/">
<span class="md-ellipsis">
    Application Setup
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Application Setup
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-application-setup/01-ApplicationSettings/">
<span class="md-ellipsis">
    Application Settings
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-application-setup/02-ApplicationSubmit/">
<span class="md-ellipsis">
    Submitting Data Quality Application
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-application-setup/03-ResultsStorage/">
<span class="md-ellipsis">
    Data Quality Results Storage
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-application-setup/04-APIServer/">
<span class="md-ellipsis">
    API Server
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    General Information
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            General Information
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01-WorkingWithDateTime/">
<span class="md-ellipsis">
    Working with Date and Time
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02-EnvironmentAndExtraVariables/">
<span class="md-ellipsis">
    Usage of Environment Variables and Extra Variables
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-StatusModel/">
<span class="md-ellipsis">
    Status Model used in Results
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04-ErrorCollection/">
<span class="md-ellipsis">
    Metric Error Collection
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05-StreamingMode/">
<span class="md-ellipsis">
    Data Quality Checks over Streaming Sources
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06-MetricSQLEquivalency/">
<span class="md-ellipsis">
    Metrics SQL Equivalency
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Metric Calculator Engines Overview and Benchmarking
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Metric Calculator Engines Overview and Benchmarking
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#benchmarking">
<span class="md-ellipsis">
      Benchmarking
    </span>
</a>
<nav aria-label="Benchmarking" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#about-dataset">
<span class="md-ellipsis">
      About Dataset
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#spark-configuration">
<span class="md-ellipsis">
      Spark Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyspark-job-run">
<span class="md-ellipsis">
      PySpark Job Run
    </span>
</a>
<nav aria-label="PySpark Job Run" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#pyspark-single-pass-metrics-test-results">
<span class="md-ellipsis">
      Pyspark Single-Pass Metrics Test Results
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pyspark-grouping-metrics-test-results">
<span class="md-ellipsis">
      Pyspark Grouping Metrics Test Results
    </span>
</a>
<nav aria-label="Pyspark Grouping Metrics Test Results" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#distinct-values-metric">
<span class="md-ellipsis">
      Distinct Values Metric
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duplicate-values-metric">
<span class="md-ellipsis">
      Duplicate Values Metric
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-rdd-engine-job-run">
<span class="md-ellipsis">
      Checkita RDD-Engine Job Run
    </span>
</a>
<nav aria-label="Checkita RDD-Engine Job Run" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-rdd-engine-single-pass-metrics-test-results">
<span class="md-ellipsis">
      Checkita RDD-Engine Single-Pass Metrics Test Results
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-rdd-engine-cardinality-metrics-test-results">
<span class="md-ellipsis">
      Checkita RDD-Engine Cardinality Metrics Test Results
    </span>
</a>
<nav aria-label="Checkita RDD-Engine Cardinality Metrics Test Results" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#distinct-values-metric_1">
<span class="md-ellipsis">
      Distinct Values Metric
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duplicate-values-metric_1">
<span class="md-ellipsis">
      Duplicate Values Metric
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-df-engine-job-run">
<span class="md-ellipsis">
      Checkita DF-Engine Job Run
    </span>
</a>
<nav aria-label="Checkita DF-Engine Job Run" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-df-engine-single-pass-metrics-test-results">
<span class="md-ellipsis">
      Checkita DF-Engine Single-Pass Metrics Test Results
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#checkita-df-engine-cardinality-metrics-test-results">
<span class="md-ellipsis">
      Checkita DF-Engine Cardinality Metrics Test Results
    </span>
</a>
<nav aria-label="Checkita DF-Engine Cardinality Metrics Test Results" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#distinct-values-metric_2">
<span class="md-ellipsis">
      Distinct Values Metric
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duplicate-values-metric_2">
<span class="md-ellipsis">
      Duplicate Values Metric
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overall-summary">
<span class="md-ellipsis">
      Overall Summary
    </span>
</a>
<nav aria-label="Overall Summary" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#single-pass-metrics">
<span class="md-ellipsis">
      Single-Pass Metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cardinality-based-metrics">
<span class="md-ellipsis">
      Cardinality-Based Metrics
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusions">
<span class="md-ellipsis">
      Conclusions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dq-job-configuration-files">
<span class="md-ellipsis">
      DQ Job Configuration files
    </span>
</a>
<nav aria-label="DQ Job Configuration files" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#single-pass-metrics_1">
<span class="md-ellipsis">
      Single-pass metrics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#distinct-values-metric_3">
<span class="md-ellipsis">
      Distinct values metric
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#duplicate-values-metric_3">
<span class="md-ellipsis">
      Duplicate values metric
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08-CheckFailureTolerance/">
<span class="md-ellipsis">
    Check Failure Tolerance
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../03-job-configuration/">
<span class="md-ellipsis">
    Job Configuration
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Job Configuration
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/01-Connections/">
<span class="md-ellipsis">
    Connections Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/02-Schemas/">
<span class="md-ellipsis">
    Schemas Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/03-Sources/">
<span class="md-ellipsis">
    Sources Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/04-Streams/">
<span class="md-ellipsis">
    Streaming Sources Configurations
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/05-VirtualSources/">
<span class="md-ellipsis">
    Virtual Sources Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/06-VirtualStreams/">
<span class="md-ellipsis">
    Virtual Streaming Sources Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/07-LoadChecks/">
<span class="md-ellipsis">
    Load Checks Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/08-Metrics/">
<span class="md-ellipsis">
    Metrics Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/09-Checks/">
<span class="md-ellipsis">
    Checks Configurations
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/10-Targets/">
<span class="md-ellipsis">
    Targets Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/11-FileOutputs/">
<span class="md-ellipsis">
    File Output Configuration
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-job-configuration/12-JobConfigExample/">
<span class="md-ellipsis">
    Job Configuration Example
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../changelog/CHANGELOG/">
<span class="md-ellipsis">
    Changelog
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../contribution/">
<span class="md-ellipsis">
    Contribution
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Contribution
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../contribution/code-of-conduct/">
<span class="md-ellipsis">
    Code of Conduct
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../contribution/contribution/">
<span class="md-ellipsis">
    Contribution Guide
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../api/">
<span class="md-ellipsis">
    Scala API Doc
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../swagger/">
<span class="md-ellipsis">
    Swagger Doc
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="metric-calculator-engines-overview-and-benchmarking">Metric Calculator Engines Overview and Benchmarking</h1>
<p>Checkita DataQuality contains various data quality metrics which all are computed during single pass over the data.
Still, there are some metrics that are based on exact cardinality evaluation. Computation of this metrics requires
either storing large state in memory (unique records) or shuffling data. First approach can cause OOM errors
and the second one violates statement that data is read only once.</p>
<p>Checkita has to engines for metric computation: RDD-based engine and DF-based engine. Thus, RDD-based engine
uses first approach to calculate cardinality-based metrics: metric calculators store in memory collection of all
unique records. The DF-based engine, on the other hand, groups and shuffles the data to compute cardinality during
latter reduce stage.</p>
<p>There are some additional points that need to be considered when choosing appropriate engine to run data quality job:</p>
<ul>
<li>RDD-based engine provide more flexibility when it is required to work closely with row data. Downside of such 
  flexibility is that accessing row elements as Java-objects yields significant serialization/deserialization overhead.</li>
<li>DF-based engine on the other hand operates using Spark UnsafeRow format which is stored off-heap and, in addition, 
  has some performance leverage from using Tungsten whole-stage code generation. Problem here is that intermediate
  state of the calculator cannot be accessed and operated with.</li>
</ul>
<p><strong>Concluding the statements above, we recommend using DF-based engine for batch applications. While streaming 
applications support only RDD-based engine due to states of the calculators have to be merged between the
processing windows and out of the Spark runtime.</strong></p>
<h2 id="benchmarking">Benchmarking</h2>
<p>Benchmark tests below separated into two parts:</p>
<ul>
<li>evaluate all single-pass metrics (except cardinality-based ones)</li>
<li>evaluate cardinality-based metrics</li>
</ul>
<p>Along with running Checkita DQ jobs using either RDD-based of DF-based engine, the same metrics were computed 
using PySpark job in order to assess how well Checkita performs metric computation as compared to raw Spark code.</p>
<h3 id="about-dataset">About Dataset</h3>
<p>The New York Taxi dataset was chosen for processing as it contains massive amount of data collected since 2009.</p>
<p>For the purpose of DQ job run the data for 2009 year was selected from following sources:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-01.parquet
</span><span id="__span-0-2">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-02.parquet
</span><span id="__span-0-3">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-03.parquet
</span><span id="__span-0-4">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-04.parquet
</span><span id="__span-0-5">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-05.parquet
</span><span id="__span-0-6">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-06.parquet
</span><span id="__span-0-7">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-07.parquet
</span><span id="__span-0-8">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-08.parquet
</span><span id="__span-0-9">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-09.parquet
</span><span id="__span-0-10">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-10.parquet
</span><span id="__span-0-11">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-11.parquet
</span><span id="__span-0-12">https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2009-12.parquet
</span></code></pre></div>
<p>Datasets are stored in Parquet format and are read as is during DQ job processing.</p>
<p>All parquet files has the same schema:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1">root
</span><span id="__span-1-2"> |-- vendor_name: string (nullable = true)
</span><span id="__span-1-3"> |-- Trip_Pickup_DateTime: string (nullable = true)
</span><span id="__span-1-4"> |-- Trip_Dropoff_DateTime: string (nullable = true)
</span><span id="__span-1-5"> |-- Passenger_Count: long (nullable = true)
</span><span id="__span-1-6"> |-- Trip_Distance: double (nullable = true)
</span><span id="__span-1-7"> |-- Start_Lon: double (nullable = true)
</span><span id="__span-1-8"> |-- Start_Lat: double (nullable = true)
</span><span id="__span-1-9"> |-- Rate_Code: double (nullable = true)
</span><span id="__span-1-10"> |-- store_and_forward: double (nullable = true)
</span><span id="__span-1-11"> |-- End_Lon: double (nullable = true)
</span><span id="__span-1-12"> |-- End_Lat: double (nullable = true)
</span><span id="__span-1-13"> |-- Payment_Type: string (nullable = true)
</span><span id="__span-1-14"> |-- Fare_Amt: double (nullable = true)
</span><span id="__span-1-15"> |-- surcharge: double (nullable = true)
</span><span id="__span-1-16"> |-- mta_tax: double (nullable = true)
</span><span id="__span-1-17"> |-- Tip_Amt: double (nullable = true)
</span><span id="__span-1-18"> |-- Tolls_Amt: double (nullable = true)
</span><span id="__span-1-19"> |-- Total_Amt: double (nullable = true)
</span></code></pre></div>
<h3 id="spark-configuration">Spark Configuration</h3>
<p>All jobs in these test were run using the same Spark application configuration with following parameters:</p>
<div class="language-properties highlight"><pre><span></span><code><span id="__span-2-1"><span class="na">"spark.driver.cores"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span>
</span><span id="__span-2-2"><span class="na">"spark.driver.memory"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"4G"</span>
</span><span id="__span-2-3"><span class="na">"spark.executor.memory"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"12G"</span>
</span><span id="__span-2-4"><span class="na">"spark.executor.cores"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"4"</span>
</span><span id="__span-2-5"><span class="na">"spark.executor.instances"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"3"</span>
</span><span id="__span-2-6"><span class="na">"spark.shuffle.service.enabled"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-2-7"><span class="na">"spark.sql.shuffle.partitions"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"12"</span>
</span><span id="__span-2-8"><span class="na">"spark.default.parallelism"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"12"</span>
</span><span id="__span-2-9"><span class="na">"spark.dynamicAllocation.enabled"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-2-10"><span class="na">"spark.sql.orc.enabled"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-2-11"><span class="na">"spark.sql.parquet.compression.codec"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"snappy"</span>
</span><span id="__span-2-12"><span class="na">"spark.sql.autoBroadcastJoinThreshold"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">-1</span>
</span><span id="__span-2-13"><span class="na">"spark.sql.caseSensitive"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-2-14"><span class="na">"spark.sql.legacy.timeParserPolicy"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"CORRECTED"</span>
</span></code></pre></div>
<blockquote>
<p><strong>IMPORTANT</strong> For cardinality-based metric tests the parallelism has been increased to 1000:
<div class="language-properties highlight"><pre><span></span><code><span id="__span-3-1"><span class="na">"spark.sql.shuffle.partitions"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"1000"</span>
</span><span id="__span-3-2"><span class="na">"spark.default.parallelism"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"1000"</span>
</span></code></pre></div></p>
</blockquote>
<h3 id="pyspark-job-run">PySpark Job Run</h3>
<p>First of all, we tried to compute the data quality metrics directly,
using PySpark API and measured time, that job had taken.</p>
<p>Below is the code for computing single-pass metrics:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">DoubleType</span>
</span><span id="__span-4-2"><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">lit</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="nb">sum</span> <span class="k">as</span> <span class="n">Fsum</span><span class="p">,</span> <span class="nb">min</span> <span class="k">as</span> <span class="n">Fmin</span><span class="p">,</span> <span class="nb">max</span> <span class="k">as</span> <span class="n">Fmax</span><span class="p">,</span> <span class="n">datediff</span><span class="p">,</span> \
</span><span id="__span-4-3">    <span class="n">length</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">covar_pop</span><span class="p">,</span> <span class="n">covar_samp</span><span class="p">,</span> <span class="n">percentile_approx</span><span class="p">,</span> <span class="n">levenshtein</span><span class="p">,</span> <span class="n">stddev_pop</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">to_timestamp</span><span class="p">,</span> <span class="n">upper</span>
</span><span id="__span-4-4">
</span><span id="__span-4-5"><span class="c1"># spark = &lt;initiate spark session&gt;</span>
</span><span id="__span-4-6">
</span><span id="__span-4-7"><span class="n">ytd</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s1">'&lt;path to folder with NY Taxi dataset&gt;'</span><span class="p">)</span>
</span><span id="__span-4-8">
</span><span id="__span-4-9"><span class="n">ytd</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-10">    <span class="s2">"null_pmt_typ"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-4-11"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-12">    <span class="s2">"empty_pmt_typ"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)</span> <span class="o">==</span> <span class="n">lit</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-4-13"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-14">    <span class="s2">"null_vendor"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'vendor_name'</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-4-15"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-16">    <span class="s2">"date_1"</span><span class="p">,</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_pickup_datetime'</span><span class="p">),</span> <span class="s2">"yyyy-MM-dd HH-mm-ss"</span><span class="p">)</span>
</span><span id="__span-4-17"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-18">    <span class="s2">"date_2"</span><span class="p">,</span> <span class="n">to_timestamp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_dropoff_datetime'</span><span class="p">),</span> <span class="s2">"yyyy-MM-dd HH-mm-ss"</span><span class="p">)</span>
</span><span id="__span-4-19"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-20">    <span class="s2">"date_fmt_1"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_1'</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-4-21"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-22">    <span class="s2">"date_fmt_2"</span><span class="p">,</span> <span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_2'</span><span class="p">)</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-4-23"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-24">    <span class="s2">"precision"</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span> <span class="o">-</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-25"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-26">    <span class="s2">"scale"</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">split</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">()),</span> <span class="s1">'\.'</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-4-27"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-28">    <span class="s2">"num_fmt_crit"</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'precision'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'scale'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-4-29"><span class="p">)</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="__span-4-30">    <span class="s2">"num_to_cast"</span><span class="p">,</span> <span class="n">split</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_pickup_datetime'</span><span class="p">),</span> <span class="s1">'-'</span><span class="p">)</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-4-31"><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="__span-4-32">    <span class="n">count</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'row_count'</span><span class="p">),</span>
</span><span id="__span-4-33">    <span class="n">Fsum</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'null_pmt_typ'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'null_vals'</span><span class="p">),</span>
</span><span id="__span-4-34">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'empty_pmt_typ'</span><span class="p">)</span> <span class="o">==</span> <span class="n">lit</span><span class="p">(</span><span class="s1">''</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'empty_vals'</span><span class="p">),</span>
</span><span id="__span-4-35">    <span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fsum</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'null_pmt_typ'</span><span class="p">)</span> <span class="o">+</span> <span class="n">col</span><span class="p">(</span><span class="s1">'null_vendor'</span><span class="p">))</span> <span class="o">/</span> <span class="n">lit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">count</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'completeness'</span><span class="p">),</span>
</span><span id="__span-4-36">    <span class="n">Fmin</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'min_str'</span><span class="p">),</span>
</span><span id="__span-4-37">    <span class="n">Fmax</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'max_str'</span><span class="p">),</span>
</span><span id="__span-4-38">    <span class="n">avg</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'avg_str'</span><span class="p">),</span>
</span><span id="__span-4-39">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span> <span class="o">==</span> <span class="n">lit</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'str_len'</span><span class="p">),</span>
</span><span id="__span-4-40">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'vendor_name'</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s2">"VTS"</span><span class="p">,</span> <span class="s2">"DDS"</span><span class="p">,</span> <span class="s2">"CMT"</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'str_in_dmn'</span><span class="p">),</span>
</span><span id="__span-4-41">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="o">~</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="s2">"Credit"</span><span class="p">,</span> <span class="s2">"Cash"</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'str_out_dmn'</span><span class="p">),</span>
</span><span id="__span-4-42">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'payment_type'</span><span class="p">)</span> <span class="o">==</span> <span class="n">lit</span><span class="p">(</span><span class="s2">"No Charge"</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'str_vals'</span><span class="p">),</span>
</span><span id="__span-4-43">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'tip_amt'</span><span class="p">)</span><span class="o">.</span><span class="n">rlike</span><span class="p">(</span><span class="sa">r</span><span class="s2">"^\d\d+\..+$"</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'rgx_match'</span><span class="p">),</span>
</span><span id="__span-4-44">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="o">~</span><span class="n">col</span><span class="p">(</span><span class="s1">'end_lat'</span><span class="p">)</span><span class="o">.</span><span class="n">rlike</span><span class="p">(</span><span class="sa">r</span><span class="s2">"^40\..*$"</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'rgx_mismatch'</span><span class="p">),</span>
</span><span id="__span-4-45">    <span class="n">Fsum</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_fmt_1'</span><span class="p">)</span> <span class="o">+</span> <span class="n">col</span><span class="p">(</span><span class="s1">'date_fmt_2'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'fmt_date'</span><span class="p">),</span>
</span><span id="__span-4-46">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'num_fmt_crit'</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'fmt_number'</span><span class="p">),</span>
</span><span id="__span-4-47">    <span class="n">Fmin</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'total_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'min_num'</span><span class="p">),</span>
</span><span id="__span-4-48">    <span class="n">Fmax</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'total_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'max_num'</span><span class="p">),</span>
</span><span id="__span-4-49">    <span class="n">Fsum</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'total_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'sum_num'</span><span class="p">),</span>
</span><span id="__span-4-50">    <span class="n">avg</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'total_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'avg_num'</span><span class="p">),</span>
</span><span id="__span-4-51">    <span class="n">stddev_pop</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'total_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'std_num'</span><span class="p">),</span>
</span><span id="__span-4-52">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'num_to_cast'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">())</span><span class="o">.</span><span class="n">isNull</span><span class="p">(),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'cast_num'</span><span class="p">),</span>
</span><span id="__span-4-53">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'passenger_count'</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_in_dmn'</span><span class="p">),</span>
</span><span id="__span-4-54">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="o">~</span><span class="n">col</span><span class="p">(</span><span class="s1">'passenger_count'</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_out_dmn'</span><span class="p">),</span>
</span><span id="__span-4-55">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lit</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_less_than'</span><span class="p">),</span>
</span><span id="__span-4-56">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">lit</span><span class="p">(</span><span class="mf">30.0</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_greater_than'</span><span class="p">),</span>
</span><span id="__span-4-57">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span>
</span><span id="__span-4-58">        <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-59">    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_btwn'</span><span class="p">),</span>
</span><span id="__span-4-60">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span>
</span><span id="__span-4-61">        <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">lit</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-62">    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_not_btwn'</span><span class="p">),</span>
</span><span id="__span-4-63">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'tolls_amt'</span><span class="p">)</span> <span class="o">==</span> <span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'num_vals'</span><span class="p">),</span>
</span><span id="__span-4-64">    <span class="n">percentile_approx</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'median_val'</span><span class="p">),</span>
</span><span id="__span-4-65">    <span class="n">percentile_approx</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'first_quant_val'</span><span class="p">),</span>
</span><span id="__span-4-66">    <span class="n">percentile_approx</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">),</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'third_quant_val'</span><span class="p">),</span>
</span><span id="__span-4-67">    <span class="n">percentile_approx</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">),</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'get_quant_val'</span><span class="p">),</span>
</span><span id="__span-4-68">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'start_lon'</span><span class="p">)</span> <span class="o">==</span> <span class="n">col</span><span class="p">(</span><span class="s1">'end_lon'</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'col_eq'</span><span class="p">),</span>
</span><span id="__span-4-69">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">datediff</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'date_1'</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s1">'date_2'</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'date_dist'</span><span class="p">),</span>
</span><span id="__span-4-70">    <span class="n">Fsum</span><span class="p">(</span><span class="n">when</span><span class="p">(</span>
</span><span id="__span-4-71">        <span class="n">levenshtein</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'start_lat'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">())),</span> <span class="n">upper</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'end_lat'</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">StringType</span><span class="p">())))</span> <span class="o">&lt;</span> <span class="n">lit</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-72">    <span class="p">)</span><span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'lvnst_dist'</span><span class="p">),</span>
</span><span id="__span-4-73">    <span class="p">(</span><span class="n">covar_pop</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">))</span> <span class="o">*</span> <span class="n">count</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'comoment'</span><span class="p">),</span>
</span><span id="__span-4-74">    <span class="n">covar_pop</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'covariance'</span><span class="p">),</span>
</span><span id="__span-4-75">    <span class="n">covar_samp</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">),</span> <span class="n">col</span><span class="p">(</span><span class="s1">'fare_amt'</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'covarianceBessel'</span><span class="p">)</span>
</span><span id="__span-4-76"><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vertical</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="pyspark-single-pass-metrics-test-results">Pyspark Single-Pass Metrics Test Results</h4>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>6.3 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>46</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>52 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>5.3 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>1467.6 KiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>46</td>
</tr>
</tbody>
</table>
<p>Longest tasks statistics (tasks that actually read all 12 dataset parquet files):</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>6.3 min</td>
<td>12 s</td>
<td>498.3 MiB / 15604551</td>
<td>127.8 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>5.0 min</td>
<td>11 s</td>
<td>445.9 MiB / 14092413</td>
<td>119.5 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>5.0 min</td>
<td>11 s</td>
<td>452.3 MiB / 14275339</td>
<td>124.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>4.8 min</td>
<td>11 s</td>
<td>420.4 MiB / 13380122</td>
<td>117.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>4.0 min</td>
<td>8 s</td>
<td>469.1 MiB / 14796313</td>
<td>123.6 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>4.0 min</td>
<td>8 s</td>
<td>461.3 MiB / 14583404</td>
<td>124.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>3.9 min</td>
<td>8 s</td>
<td>456.9 MiB / 14387371</td>
<td>118.7 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.8 min</td>
<td>9 s</td>
<td>452.8 MiB / 14294783</td>
<td>117.5 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>3.8 min</td>
<td>8 s</td>
<td>434.7 MiB / 13686520</td>
<td>122.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.7 min</td>
<td>8 s</td>
<td>449.2 MiB / 14184249</td>
<td>123.7 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.7 min</td>
<td>8 s</td>
<td>444.3 MiB / 13984887</td>
<td>123.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.6 min</td>
<td>8 s</td>
<td>431.4 MiB / 13626103</td>
<td>122.5 KiB / 1</td>
</tr>
</tbody>
</table>
<h4 id="pyspark-grouping-metrics-test-results">Pyspark Grouping Metrics Test Results</h4>
<h5 id="distinct-values-metric">Distinct Values Metric</h5>
<p>First test for cardinality-based metrics is to calculate number of distinct values.
Below is the PySpark code to calculate number of distinct trip distances:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><span class="n">dist_vals</span> <span class="o">=</span> <span class="n">ytd</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s1">'trip_distance'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span id="__span-5-2">
</span><span id="__span-5-3"><span class="nb">print</span><span class="p">(</span><span class="n">dist_vals</span><span class="p">)</span>
</span></code></pre></div>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>58 sec</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>996</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>1.1 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>228.3 MiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>1015.7 KiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>47860</td>
</tr>
</tbody>
</table>
<p>Mapping tasks statistics (tasks that actually scanned all 12 dataset parquet files).
Note that scanning parquet files for distinct column values is extremely fast!</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1 s</td>
<td></td>
<td>18.9 MiB / 15604551</td>
<td>83.5 KiB / 3882</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1 s</td>
<td>19.0 ms</td>
<td>18.1 MiB / 14092413</td>
<td>102.8 KiB / 5716</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1 s</td>
<td></td>
<td>18.1 MiB / 14583404</td>
<td>83.6 KiB / 3862</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1 s</td>
<td>18.0 ms</td>
<td>18.0 MiB / 14796313</td>
<td>82.8 KiB / 3817</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1 s</td>
<td></td>
<td>17.6 MiB / 14294783</td>
<td>82.6 KiB / 3799</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1 s</td>
<td></td>
<td>17.6 MiB / 14184249</td>
<td>82.6 KiB / 3816</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1 s</td>
<td></td>
<td>17.3 MiB / 14275339</td>
<td>82.9 KiB / 3826</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1 s</td>
<td></td>
<td>17.1 MiB / 14387371</td>
<td>82.2 KiB / 3797</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1 s</td>
<td></td>
<td>17.0 MiB / 13984887</td>
<td>83.2 KiB / 3841</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1 s</td>
<td></td>
<td>17.0 MiB / 13686520</td>
<td>83.6 KiB / 3879</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1 s</td>
<td></td>
<td>16.8 MiB / 13626103</td>
<td>82.9 KiB / 3834</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1 s</td>
<td></td>
<td>16.1 MiB / 13380122</td>
<td>83.0 KiB / 3791</td>
</tr>
</tbody>
</table>
<h5 id="duplicate-values-metric">Duplicate Values Metric</h5>
<p>Let's calculate duplicated trips. These are trips for which following columns do match:</p>
<ul>
<li><code>vendor_name</code></li>
<li><code>trip_pickup_datetime</code></li>
<li><code>trip_dropoff_datetime</code></li>
<li><code>start_lon</code></li>
<li><code>start_lat</code></li>
<li><code>end_lon</code></li>
<li><code>end_lat</code></li>
</ul>
<p>PySpark code to calculate number of duplicated trips is following:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><span class="n">dupl_vals</span> <span class="o">=</span> <span class="n">ytd</span><span class="o">.</span><span class="n">groupBy</span><span class="p">(</span>
</span><span id="__span-6-2">    <span class="s1">'vendor_name'</span><span class="p">,</span> 
</span><span id="__span-6-3">    <span class="s1">'trip_pickup_datetime'</span><span class="p">,</span> 
</span><span id="__span-6-4">    <span class="s1">'trip_dropoff_datetime'</span><span class="p">,</span>
</span><span id="__span-6-5">    <span class="s1">'start_lon'</span><span class="p">,</span>
</span><span id="__span-6-6">    <span class="s1">'start_lat'</span><span class="p">,</span>
</span><span id="__span-6-7">    <span class="s1">'end_lon'</span><span class="p">,</span>
</span><span id="__span-6-8">    <span class="s1">'end_lat'</span>
</span><span id="__span-6-9"><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span id="__span-6-10">    <span class="p">(</span><span class="n">count</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">'cnt'</span><span class="p">)</span>
</span><span id="__span-6-11"><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Fsum</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'cnt'</span><span class="p">)))</span><span class="o">.</span><span class="n">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-6-12">
</span><span id="__span-6-13"><span class="nb">print</span><span class="p">(</span><span class="n">dupl_vals</span><span class="p">)</span>
</span></code></pre></div>
<p>Summary:
Note that shuffling operations did spill lots of data to both memory and disk!</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>2.5 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>996</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>15 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>4.6 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>7.9 GiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>170861620</td>
</tr>
<tr>
<td><strong>Spill Memory</strong></td>
<td>27.4 GiB</td>
</tr>
<tr>
<td><strong>Spill Disk</strong></td>
<td>6.8 GiB</td>
</tr>
</tbody>
</table>
<p>Mapping tasks statistics (tasks that actually scanned all 12 dataset parquet files).</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
<th>Spill (Memory)</th>
<th>Spill (Disk)</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1.9 min</td>
<td>12 s</td>
<td>405.4 MiB / 14796313</td>
<td>672.8 MiB / 14793946</td>
<td>3.9 GiB</td>
<td>1 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1.9 min</td>
<td>12 s</td>
<td>393.4 MiB / 14387371</td>
<td>655.1 MiB / 14386632</td>
<td>3.9 GiB</td>
<td>1 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1.8 min</td>
<td>11 s</td>
<td>387.8 MiB / 14184249</td>
<td>647.2 MiB / 14181699</td>
<td>2.6 GiB</td>
<td>564.6 MiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>1.7 min</td>
<td>12 s</td>
<td>372.1 MiB / 13626103</td>
<td>622.2 MiB / 13624190</td>
<td>3.7 GiB</td>
<td>1002.1 MiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1.3 min</td>
<td>4 s</td>
<td>397.2 MiB / 14583404</td>
<td>661.9 MiB / 14575564</td>
<td>4.4 GiB</td>
<td>1.2 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1.2 min</td>
<td>5 s</td>
<td>375.2 MiB / 13686520</td>
<td>624.4 MiB / 13684841</td>
<td>3.8 GiB</td>
<td>997.5 MiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1.2 min</td>
<td>3 s</td>
<td>390.0 MiB / 14275339</td>
<td>648.4 MiB / 14270095</td>
<td>2.6 GiB</td>
<td>565 MiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1.1 min</td>
<td>3 s</td>
<td>383.1 MiB / 14092413</td>
<td>641.1 MiB / 14090159</td>
<td>2.5 GiB</td>
<td>559.5 MiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>40 s</td>
<td>3 s</td>
<td>429.6 MiB / 15604551</td>
<td>808.8 MiB / 15599852</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>36 s</td>
<td>3 s</td>
<td>390.2 MiB / 14294783</td>
<td>740.1 MiB / 14293543</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>34 s</td>
<td>1 s</td>
<td>383.3 MiB / 13984887</td>
<td>724.5 MiB / 13982756</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>33 s</td>
<td>0.8 s</td>
<td>362.4 MiB / 13380122</td>
<td>692.6 MiB / 13378343</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="checkita-rdd-engine-job-run">Checkita RDD-Engine Job Run</h3>
<h4 id="checkita-rdd-engine-single-pass-metrics-test-results">Checkita RDD-Engine Single-Pass Metrics Test Results</h4>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>23 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>46</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>3.7 hour</td>
</tr>
<tr>
<td>Total input size</td>
<td>5.3 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>2.1 MiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>46</td>
</tr>
</tbody>
</table>
<p>Longest tasks statistics (tasks that actually read all 12 dataset parquet files):</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>23 min</td>
<td>49 s</td>
<td>456.2 MiB / 14275339</td>
<td>129.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>22 min</td>
<td>49 s</td>
<td>448.0 MiB / 14092413</td>
<td>179.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>22 min</td>
<td>49 s</td>
<td>446.7 MiB / 13984887</td>
<td>138.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>22 min</td>
<td>48 s</td>
<td>422.9 MiB / 13380122</td>
<td>156.5 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>18 min</td>
<td>27 s</td>
<td>503.1 MiB / 15604551</td>
<td>139.6 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>17 min</td>
<td>27 s</td>
<td>472.4 MiB / 14796313</td>
<td>131.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>17 min</td>
<td>26 s</td>
<td>456.0 MiB / 14294783</td>
<td>159.3 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>17 min</td>
<td>23 s</td>
<td>465.0 MiB / 14583404</td>
<td>133.3 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>16 min</td>
<td>23 s</td>
<td>460.2 MiB / 14387371</td>
<td>166.2 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>16 min</td>
<td>23 s</td>
<td>451.7 MiB / 14184249</td>
<td>135.0 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>16 min</td>
<td>26 s</td>
<td>437.0 MiB / 13686520</td>
<td>139.9 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>16 min</td>
<td>23 s</td>
<td>433.6 MiB / 13626103</td>
<td>137.6 KiB / 1</td>
</tr>
</tbody>
</table>
<h4 id="checkita-rdd-engine-cardinality-metrics-test-results">Checkita RDD-Engine Cardinality Metrics Test Results</h4>
<h5 id="distinct-values-metric_1">Distinct Values Metric</h5>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>2.1 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>996</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>14 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>5.3 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>1621.7 KiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>996</td>
</tr>
</tbody>
</table>
<p>Longest tasks statistics (tasks that actually read all 12 dataset parquet files):</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1.5 min</td>
<td>3 s</td>
<td>503.1 MiB / 15604551</td>
<td>20.6 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1.4 min</td>
<td>3 s</td>
<td>465 MiB / 14583404</td>
<td>20.5 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1.3 min</td>
<td>3 s</td>
<td>446.7 MiB / 13984887</td>
<td>20.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>1.3 min</td>
<td>3 s</td>
<td>448 MiB / 14092413</td>
<td>31.2 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>58 s</td>
<td>2 s</td>
<td>472.4 MiB / 14796313</td>
<td>20.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>57 s</td>
<td>2 s</td>
<td>456 MiB / 14294783</td>
<td>20.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>55 s</td>
<td>1.0 s</td>
<td>460.2 MiB / 14387371</td>
<td>20.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>54 s</td>
<td>1 s</td>
<td>437 MiB / 13686520</td>
<td>20.5 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>53 s</td>
<td>0.7 s</td>
<td>451.7 MiB / 14184249</td>
<td>20.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>53 s</td>
<td>0.6 s</td>
<td>456.2 MiB / 14275339</td>
<td>20.2 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>53 s</td>
<td>1 s</td>
<td>433.6 MiB / 13626103</td>
<td>20.3 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>46 s</td>
<td>0.4 s</td>
<td>422.9 MiB / 13380122</td>
<td>20.3 KiB / 1</td>
</tr>
</tbody>
</table>
<h5 id="duplicate-values-metric_1">Duplicate Values Metric</h5>
<p>Calculation failed with OOM error. The reason is that RDD-metric calculator for duplicate values must
store all unique values within its state, i.e. within simple Java collection. For cases when number of
unique records is high (in our case its about 170 million records) the executors will fail with OOM error.</p>
<h3 id="checkita-df-engine-job-run">Checkita DF-Engine Job Run</h3>
<h4 id="checkita-df-engine-single-pass-metrics-test-results">Checkita DF-Engine Single-Pass Metrics Test Results</h4>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>4.1 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>46</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>46 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>5.3 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>4.5 MiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>46</td>
</tr>
</tbody>
</table>
<p>Longest tasks statistics (tasks that actually read all 12 dataset parquet files):</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>4.0 min</td>
<td>4 s</td>
<td>469.1 MiB / 14796313</td>
<td>358.9 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>4.0 min</td>
<td>3 s</td>
<td>498.3 MiB / 15604551</td>
<td>401.7 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.9 min</td>
<td>2 s</td>
<td>456.9 MiB / 14387371</td>
<td>381.0 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>3.9 min</td>
<td>4 s</td>
<td>461.3 MiB / 14583404</td>
<td>359.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>3.9 min</td>
<td>4 s</td>
<td>449.2 MiB / 14184249</td>
<td>359.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>3.8 min</td>
<td>4 s</td>
<td>445.9 MiB / 14092413</td>
<td>415.1 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>3.8 min</td>
<td>4 s</td>
<td>452.8 MiB / 14294783</td>
<td>375.9 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>3.8 min</td>
<td>4 s</td>
<td>444.3 MiB / 13984887</td>
<td>390.0 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>3.7 min</td>
<td>4 s</td>
<td>452.3 MiB / 14275339</td>
<td>396.9 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.6 min</td>
<td>2 s</td>
<td>431.4 MiB / 13626103</td>
<td>358.4 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>3.5 min</td>
<td>3 s</td>
<td>420.4 MiB / 13380122</td>
<td>391.2 KiB / 1</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>3.4 min</td>
<td>2 s</td>
<td>434.7 MiB / 13686520</td>
<td>361.4 KiB / 1</td>
</tr>
</tbody>
</table>
<h4 id="checkita-df-engine-cardinality-metrics-test-results">Checkita DF-Engine Cardinality Metrics Test Results</h4>
<h5 id="distinct-values-metric_2">Distinct Values Metric</h5>
<p>Summary:</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>1.2 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>996</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>4.0 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>908.2 MiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>199.0 MiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>47860</td>
</tr>
</tbody>
</table>
<p>Longest tasks statistics (tasks that actually read all 12 dataset parquet files):</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>20 s</td>
<td>3 s</td>
<td>81.0 MiB / 15604551</td>
<td>17.1 MiB / 3882</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>15 s</td>
<td>1 s</td>
<td>74.7 MiB / 14387371</td>
<td>16.5 MiB / 3797</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>15 s</td>
<td>1 s</td>
<td>74.9 MiB / 14294783</td>
<td>16.3 MiB / 3799</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>14 s</td>
<td>1 s</td>
<td>77.3 MiB / 14796313</td>
<td>16.8 MiB / 3817</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>14 s</td>
<td>0.5 s</td>
<td>74.0 MiB / 14275339</td>
<td>16.7 MiB / 3826</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>13 s</td>
<td>1 s</td>
<td>74.4 MiB / 14092413</td>
<td>16.9 MiB / 5716</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>13 s</td>
<td>1 s</td>
<td>72.4 MiB / 13984887</td>
<td>16.7 MiB / 3841</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>12 s</td>
<td>0.5 s</td>
<td>69.3 MiB / 13380122</td>
<td>15.6 MiB / 3791</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>12 s</td>
<td>1.0 s</td>
<td>73.8 MiB / 14184249</td>
<td>16.5 MiB / 3816</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>12 s</td>
<td>0.7 s</td>
<td>71.2 MiB / 13686520</td>
<td>16.7 MiB / 3879</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>12 s</td>
<td>0.2 s</td>
<td>75.9 MiB / 14583404</td>
<td>16.8 MiB / 3862</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>12 s</td>
<td>0.4 s</td>
<td>70.7 MiB / 13626103</td>
<td>16.4 MiB / 3834</td>
</tr>
</tbody>
</table>
<h5 id="duplicate-values-metric_2">Duplicate Values Metric</h5>
<p>Summary:
Note that shuffling operations did spill lots of data to both memory and disk!</p>
<table>
<thead>
<tr>
<th>Measurement</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Overall Job Execution Time</td>
<td>3.3 min</td>
</tr>
<tr>
<td>Total Number of Tasks</td>
<td>996</td>
</tr>
<tr>
<td>Total time across all tasks</td>
<td>28 min</td>
</tr>
<tr>
<td>Total input size</td>
<td>4.6 GiB</td>
</tr>
<tr>
<td>Total records</td>
<td>170896055</td>
</tr>
<tr>
<td>Shuffle size</td>
<td>15.8 GiB</td>
</tr>
<tr>
<td>Shuffle records</td>
<td>170861620</td>
</tr>
<tr>
<td><strong>Spill Memory</strong></td>
<td>85.6 GiB</td>
</tr>
<tr>
<td><strong>Spill Disk</strong></td>
<td>19.6 GiB</td>
</tr>
</tbody>
</table>
<p>Mapping tasks statistics (tasks that actually scanned all 12 dataset parquet files).</p>
<table>
<thead>
<tr>
<th>Attempt</th>
<th>Status</th>
<th>Executor ID</th>
<th>Duration</th>
<th>GC Time</th>
<th>Input Size / Records</th>
<th>Shuffle Write Size / Records</th>
<th>Spill (Memory)</th>
<th>Spill (Disk)</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>2.6 min</td>
<td>9 s</td>
<td>390.2 MiB / 14294783</td>
<td>1.3 GiB / 14293543</td>
<td>7.7 GiB</td>
<td>1.8 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>2.5 min</td>
<td>6 s</td>
<td>383.1 MiB / 14092413</td>
<td>1.3 GiB / 14090159</td>
<td>6.3 GiB</td>
<td>1.4 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>2.5 min</td>
<td>8 s</td>
<td>372.1 MiB / 13626103</td>
<td>1.3 GiB / 13624190</td>
<td>6.0 GiB</td>
<td>1.4 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>1</td>
<td>2.4 min</td>
<td>9 s</td>
<td>375.2 MiB / 13686520</td>
<td>1.3 GiB / 13684841</td>
<td>7.6 GiB</td>
<td>1.8 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>2.3 min</td>
<td>7 s</td>
<td>390.0 MiB / 14275339</td>
<td>1.3 GiB / 14270095</td>
<td>6.4 GiB</td>
<td>1.4 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>2.2 min</td>
<td>8 s</td>
<td>383.3 MiB / 13984887</td>
<td>1.3 GiB / 13982756</td>
<td>6.3 GiB</td>
<td>1.4 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>2.2 min</td>
<td>7 s</td>
<td>429.6 MiB / 15604551</td>
<td>1.4 GiB / 15599852</td>
<td>8.0 GiB</td>
<td>1.8 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>2.2 min</td>
<td>8 s</td>
<td>387.8 MiB / 14184249</td>
<td>1.3 GiB / 14181699</td>
<td>8.3 GiB</td>
<td>1.9 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>2</td>
<td>2.2 min</td>
<td>9 s</td>
<td>405.4 MiB / 14796313</td>
<td>1.4 GiB / 14793946</td>
<td>7.8 GiB</td>
<td>1.8 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>2.1 min</td>
<td>7 s</td>
<td>397.2 MiB / 14583404</td>
<td>1.3 GiB / 14575564</td>
<td>8.4 GiB</td>
<td>1.9 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>2.1 min</td>
<td>7 s</td>
<td>393.4 MiB / 14387371</td>
<td>1.3 GiB / 14386632</td>
<td>8.2 GiB</td>
<td>1.9 GiB</td>
</tr>
<tr>
<td>0</td>
<td>SUCCESS</td>
<td>3</td>
<td>1.9 min</td>
<td>3 s</td>
<td>362.4 MiB / 13380122</td>
<td>1.2 GiB / 13378343</td>
<td>4.7 GiB</td>
<td>1015.8 MiB</td>
</tr>
</tbody>
</table>
<h3 id="overall-summary">Overall Summary</h3>
<p>Below are some general conclusions that can be made based on benchmark test results.</p>
<h4 id="single-pass-metrics">Single-Pass Metrics</h4>
<p>The average input data for the task corresponds to a single parquet file and is following:
* Average task input size is ~455 MiB.
* Average task input records are 14241338.</p>
<table>
<thead>
<tr>
<th>Test Case</th>
<th>Job Time</th>
<th>All Tasks Time</th>
<th>Avg Task Time</th>
<th>Avg GC Time</th>
<th>Avg Task Shuffle</th>
</tr>
</thead>
<tbody>
<tr>
<td>PySpark Run</td>
<td>6.3 min</td>
<td>52 min</td>
<td>4.3 min</td>
<td>9.2 sec</td>
<td>122.0 KiB</td>
</tr>
<tr>
<td>RDD-Engine Run</td>
<td>23 min</td>
<td>3.7 hour</td>
<td>18.5 min</td>
<td>32.8 sec</td>
<td>145.5 KiB</td>
</tr>
<tr>
<td>DF-Engine Run</td>
<td>4.1 min</td>
<td>46 min</td>
<td>3.8 min</td>
<td>3.3 sec</td>
<td>379.1 KiB</td>
</tr>
</tbody>
</table>
<p>Thus, DF-Engine provides roughly <strong>5 times better performance</strong> for single-pass metrics as compared to RDD-Engine.
This is due to RDD metric calculators require data serialization from DataFrame UnsafeRow format to JVM types
while DF metric calculators run purely on Spark DF-API without any loss for data serialization.</p>
<p>Also, it could be noted Checkita DF-engine shuffled more data as compared to PySpark run. This is caused by the fact
that DF metric calculators also collect row data for metric increment errors.</p>
<h4 id="cardinality-based-metrics">Cardinality-Based Metrics</h4>
<p><strong>Distinct Values Metric Calculation</strong></p>
<p>Not that computation of distinct values via PySpark code written with use of Spark DF-API as well as
via Checkita DF-Engine took credit for Parquet format specifics: the distinct values were obtained from
metadata of the corresponding column chunks rather than from reading all data line by line.
Checkita RDD-based engine on the other hand, read and processed all data records.</p>
<table>
<thead>
<tr>
<th>Test Case</th>
<th>Job Time</th>
<th>All Tasks Time</th>
<th>Avg Task Time</th>
<th>Avg GC Time</th>
<th>Avg Task Shuffle</th>
<th>Avg. Task Input Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>PySpark Run</td>
<td>58 sec</td>
<td>1.1 min</td>
<td>1 sec</td>
<td>3.1 ms</td>
<td>84.6 KiB</td>
<td>17.5 MiB</td>
</tr>
<tr>
<td>RDD-Engine Run</td>
<td>2.1 min</td>
<td>14 min</td>
<td>63 sec</td>
<td>1.7 sec</td>
<td>21.2 KiB</td>
<td>454.4 MiB</td>
</tr>
<tr>
<td>DF-Engine Run</td>
<td>1.2 min</td>
<td>4.0 min</td>
<td>13.7 sec</td>
<td>0.9 sec</td>
<td>16.6 MiB</td>
<td>74.1 MiB</td>
</tr>
</tbody>
</table>
<p>Thus, according to the test above, the Checkita DF-engine provided roughly <strong>2 times better performance</strong> for distinct
values calculation as compared to RDD-engine. In addition to that, DF-engine can take benefits of data columnar formats
while RDD-engine will process all the records from dataset.</p>
<p>It also should be noted, that difference in performance between DF-Engine and RDD-engine will grow with the
growth of column values cardinality. For the test above we have intentionally chosen column with low cardinality to
prevent possible OOM errors for RDD-based distinct value metric calculator.</p>
<p>In the test above PySpark code run faster than Checkita DF-engine due to fact that we used the simplest way to
calculate number of distinct values for the particular column while DF-metric calculator has more general and complex
logic and, in addition, collects metric increment errors.</p>
<p><strong>Distinct Values Metric Calculation</strong></p>
<p>For calculation of duplicate values we have chosen tuple of columns with high cardinality (~170 million records).
Thus, such RDD-based duplicate values metric calculator couldn't store such amount of unique records within
its state and, therefore, application crushed with OOM error.</p>
<table>
<thead>
<tr>
<th>Test Case</th>
<th>Job Time</th>
<th>All Tasks Time</th>
<th>Avg Task Time</th>
<th>Avg GC Time</th>
<th>Avg Task Shuffle</th>
<th>Avg. Task Input Size</th>
<th>Avg. Task Spill (Mem)</th>
<th>Avg. Task Spill (Disk)</th>
</tr>
</thead>
<tbody>
<tr>
<td>PySpark Run</td>
<td>2.5 min</td>
<td>15 min</td>
<td>1.2 min</td>
<td>5.8 sec</td>
<td>678.3 MiB</td>
<td>389.1 MiB</td>
<td>2.3 GiB</td>
<td>580.5 MiB</td>
</tr>
<tr>
<td>RDD-Engine Run</td>
<td>OOM ERROR</td>
<td>---</td>
<td>---</td>
<td>---</td>
<td>---</td>
<td>---</td>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td>DF-Engine Run</td>
<td>3.3 min</td>
<td>28 min</td>
<td>2.3 min</td>
<td>7.3 sec</td>
<td>1.3 GiB</td>
<td>389.1 MiB</td>
<td>7.1 GiB</td>
<td>1.6 GiB</td>
</tr>
</tbody>
</table>
<p>Note, that PySpark application performed better that Checkita DF-Engine for the same reasons as were given above for
distinct values calculation.</p>
<h3 id="conclusions">Conclusions</h3>
<p>From the test above it can be concluded that new Checkita DF-engine provides significantly better performance comparing
to RDD-engine. We strongly recommend to use DF-engine for all batch applications.</p>
<p>However, DF metric calculators operate completely within Spark runtime. Currently, it is only possible
to retrieve final metric result after data source is processed. RDD metric calculators on the other hand are more
flexible and can be managed outside of Spark runtime. For that reason our streaming applications supports only
RDD-engine for now as we need to merge calculators from different micro-batches outside the Spark runtime.</p>
<p>There are some plans to enhance DF metric calculators to make them support streaming application as well. :)</p>
<h3 id="dq-job-configuration-files">DQ Job Configuration files</h3>
<h5 id="single-pass-metrics_1">Single-pass metrics</h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1">SRC = "ytd"
</span><span id="__span-7-2">jobConfig: {
</span><span id="__span-7-3">  jobId: "yellow_trip_data"
</span><span id="__span-7-4">  jobDescription: "Data Quality job for NY Taxi Data"
</span><span id="__span-7-5">  sources: {
</span><span id="__span-7-6">    file: [
</span><span id="__span-7-7">      {
</span><span id="__span-7-8">        id: ${SRC},
</span><span id="__span-7-9">        kind: "parquet",
</span><span id="__span-7-10">        path: "/datalake/data/workspace/mlcib/ruadlu/yellow_trip_data"
</span><span id="__span-7-11">        keyFields: ["vendor_name", "trip_pickup_datetime"]
</span><span id="__span-7-12">      }
</span><span id="__span-7-13">    ]
</span><span id="__span-7-14">  }
</span><span id="__span-7-15">  virtualSources: [
</span><span id="__span-7-16">    {
</span><span id="__span-7-17">      id: ${SRC}"_num_to_cast",
</span><span id="__span-7-18">      kind: "select"
</span><span id="__span-7-19">      parentSources: [${SRC}]
</span><span id="__span-7-20">      expr: [
</span><span id="__span-7-21">        "vendor_name",
</span><span id="__span-7-22">        "trip_pickup_datetime"
</span><span id="__span-7-23">        "split(trip_pickup_datetime, '-' )[0] as num_to_cast"
</span><span id="__span-7-24">      ]
</span><span id="__span-7-25">      keyFields: ["vendor_name", "trip_pickup_datetime"]
</span><span id="__span-7-26">    }
</span><span id="__span-7-27">  ]
</span><span id="__span-7-28">  metrics: {
</span><span id="__span-7-29">    regular: {
</span><span id="__span-7-30">      rowCount: [{id: ${SRC}"_row_cnt", source: ${SRC}}]
</span><span id="__span-7-31">      approximateDistinctValues: [{
</span><span id="__span-7-32">        id: ${SRC}"_apprx_dist_vals", source: ${SRC},
</span><span id="__span-7-33">        params: {accuracyError: 0.001}, columns: ["trip_distance"]
</span><span id="__span-7-34">      }]
</span><span id="__span-7-35">      nullValues: [{id: ${SRC}"_null_vals", source: ${SRC}, columns: ["payment_type"]}]
</span><span id="__span-7-36">      emptyValues: [{id: ${SRC}"_empty_vals", source: ${SRC}, columns: ["payment_type"]}]
</span><span id="__span-7-37">      completeness: [{id: ${SRC}"_completeness", source: ${SRC}, columns: ["vendor_name", "payment_type"]}]
</span><span id="__span-7-38">      minString: [{id: ${SRC}"_min_str", source: ${SRC}, columns: ["payment_type"]}]
</span><span id="__span-7-39">      maxString: [{id: ${SRC}"_max_str", source: ${SRC}, columns: ["payment_type"]}]
</span><span id="__span-7-40">      avgString: [{id: ${SRC}"_avg_str", source: ${SRC}, columns: ["payment_type"]}]
</span><span id="__span-7-41">      stringLength: [{
</span><span id="__span-7-42">        id: ${SRC}"_str_len", source: ${SRC}, columns: ["payment_type"],
</span><span id="__span-7-43">        params: {length: 4, compareRule: "eq"}
</span><span id="__span-7-44">      }]
</span><span id="__span-7-45">      stringInDomain: [{
</span><span id="__span-7-46">        id: ${SRC}"_str_in_dmn", source: ${SRC}, columns: ["vendor_name"],
</span><span id="__span-7-47">        params: {domain: ["VTS", "DDS", "CMT"]}
</span><span id="__span-7-48">      }]
</span><span id="__span-7-49">      stringOutDomain: [{
</span><span id="__span-7-50">        id: ${SRC}"_str_out_dmn", source: ${SRC}, columns: ["payment_type"],
</span><span id="__span-7-51">        params: {domain: ["Credit", "Cash"]}
</span><span id="__span-7-52">      }]
</span><span id="__span-7-53">      stringValues: [{
</span><span id="__span-7-54">        id: ${SRC}"_str_vals", source: ${SRC}, columns: ["payment_type"],
</span><span id="__span-7-55">        params: {compareValue: "No Charge"}
</span><span id="__span-7-56">      }]
</span><span id="__span-7-57">      regexMatch: [{
</span><span id="__span-7-58">        id: ${SRC}"_rgx_match", source: ${SRC}, columns: ["tip_amt"],
</span><span id="__span-7-59">        params: {regex: """^\d\d+\..+$"""}
</span><span id="__span-7-60">      }]
</span><span id="__span-7-61">      regexMismatch: [{
</span><span id="__span-7-62">        id: ${SRC}"_rgx_mismatch", source: ${SRC}, columns: ["end_lat"],
</span><span id="__span-7-63">        params: {regex: """^40\..*$"""}
</span><span id="__span-7-64">      }]
</span><span id="__span-7-65">      formattedDate: [{
</span><span id="__span-7-66">        id: ${SRC}"_fmt_date", source: ${SRC},
</span><span id="__span-7-67">        columns: ["trip_pickup_datetime", "trip_dropoff_datetime"],
</span><span id="__span-7-68">        params: {dateFormat: "yyyy-MM-dd HH-mm-ss"}
</span><span id="__span-7-69">      }]
</span><span id="__span-7-70">      formattedNumber: [{
</span><span id="__span-7-71">        id: ${SRC}"_fmt_number", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-72">        params: {precision: 3, scale: 2, compareRule: "inbound"}
</span><span id="__span-7-73">      }]
</span><span id="__span-7-74">      minNumber: [{id: ${SRC}"_min_num", source: ${SRC}, columns: ["total_amt"]}]
</span><span id="__span-7-75">      maxNumber: [{id: ${SRC}"_max_num", source: ${SRC}, columns: ["total_amt"]}]
</span><span id="__span-7-76">      sumNumber: [{id: ${SRC}"_sum_num", source: ${SRC}, columns: ["total_amt"]}]
</span><span id="__span-7-77">      avgNumber: [{id: ${SRC}"_avg_num", source: ${SRC}, columns: ["total_amt"]}]
</span><span id="__span-7-78">      stdNumber: [{id: ${SRC}"_std_num", source: ${SRC}, columns: ["total_amt"]}]
</span><span id="__span-7-79">      castedNumber: [{id: ${SRC}"_cast_num", source: ${SRC}"_num_to_cast", columns: ["num_to_cast"]}]
</span><span id="__span-7-80">      numberInDomain: [{
</span><span id="__span-7-81">        id: ${SRC}"_num_in_dmn", source: ${SRC}, columns: ["passenger_count"],
</span><span id="__span-7-82">        params: {domain: [1, 2, 3]}
</span><span id="__span-7-83">      }]
</span><span id="__span-7-84">      numberOutDomain: [{
</span><span id="__span-7-85">        id: ${SRC}"_num_out_dmn", source: ${SRC}, columns: ["passenger_count"],
</span><span id="__span-7-86">        params: {domain: [1, 2, 3, 4, 5]}
</span><span id="__span-7-87">      }]
</span><span id="__span-7-88">      numberLessThan: [{
</span><span id="__span-7-89">        id: ${SRC}"_num_less_than", source: ${SRC}, columns: ["trip_distance"],
</span><span id="__span-7-90">        params: {compareValue: 1.0, includeBound: false}
</span><span id="__span-7-91">      }]
</span><span id="__span-7-92">      numberGreaterThan: [{
</span><span id="__span-7-93">        id: ${SRC}"_num_greater_than", source: ${SRC}, columns: ["trip_distance"],
</span><span id="__span-7-94">        params: {compareValue: 30.0, includeBound: false}
</span><span id="__span-7-95">      }]
</span><span id="__span-7-96">      numberBetween: [{
</span><span id="__span-7-97">        id: ${SRC}"_num_btwn", source: ${SRC}, columns: ["trip_distance"],
</span><span id="__span-7-98">        params: {lowerCompareValue: 5.0, upperCompareValue: 10.0, includeBound: true}
</span><span id="__span-7-99">      }]
</span><span id="__span-7-100">      numberNotBetween: [{
</span><span id="__span-7-101">        id: ${SRC}"_num_not_btwn", source: ${SRC}, columns: ["trip_distance"],
</span><span id="__span-7-102">        params: {lowerCompareValue: 1.0, upperCompareValue: 30.0, includeBound: true}
</span><span id="__span-7-103">      }]
</span><span id="__span-7-104">      numberValues: [{
</span><span id="__span-7-105">        id: ${SRC}"_num_vals", source: ${SRC}, columns: ["tolls_amt"],
</span><span id="__span-7-106">        params: {compareValue: 0.0}
</span><span id="__span-7-107">      }]
</span><span id="__span-7-108">      medianValue: [{
</span><span id="__span-7-109">        id: ${SRC}"_median_val", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-110">        params: {accuracyError: 0.001}
</span><span id="__span-7-111">      }]
</span><span id="__span-7-112">      firstQuantile: [{
</span><span id="__span-7-113">        id: ${SRC}"_first_quant_val", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-114">        params: {accuracyError: 0.001}
</span><span id="__span-7-115">      }]
</span><span id="__span-7-116">      thirdQuantile: [{
</span><span id="__span-7-117">        id: ${SRC}"_third_quant_val", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-118">        params: {accuracyError: 0.001}
</span><span id="__span-7-119">      }]
</span><span id="__span-7-120">      getQuantile: [{
</span><span id="__span-7-121">        id: ${SRC}"_get_quant_val", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-122">        params: {accuracyError: 0.001, target: 0.9}
</span><span id="__span-7-123">      }]
</span><span id="__span-7-124">      getPercentile: [{
</span><span id="__span-7-125">        id: ${SRC}"_get_percent_val", source: ${SRC}, columns: ["fare_amt"],
</span><span id="__span-7-126">        params: {accuracyError: 0.001, target: 50.0}
</span><span id="__span-7-127">      }]
</span><span id="__span-7-128">      columnEq: [{id: ${SRC}"_col_eq", source: ${SRC}, columns: ["start_lon", "end_lon"]}]
</span><span id="__span-7-129">      dayDistance: [{
</span><span id="__span-7-130">        id: ${SRC}"_date_dist", source: ${SRC},
</span><span id="__span-7-131">        columns: ["trip_pickup_datetime", "trip_dropoff_datetime"],
</span><span id="__span-7-132">        params: {threshold: 1, dateFormat: "yyyy-MM-dd HH-mm-ss"}
</span><span id="__span-7-133">      }]
</span><span id="__span-7-134">      levenshteinDistance: [{
</span><span id="__span-7-135">        id: ${SRC}"_lvnst_dist", source: ${SRC}, columns: ["start_lat", "end_lat"],
</span><span id="__span-7-136">        params: {threshold: 3, normalize: false}
</span><span id="__span-7-137">      }]
</span><span id="__span-7-138">      coMoment: [{id: ${SRC}"_comoment", source: ${SRC}, columns: ["trip_distance", "fare_amt"]}]
</span><span id="__span-7-139">      covariance: [{id: ${SRC}"_covariance", source: ${SRC}, columns: ["trip_distance", "fare_amt"]}]
</span><span id="__span-7-140">      covarianceBessel: [{id: ${SRC}"_covariance_bessel", source: ${SRC}, columns: ["trip_distance", "fare_amt"]}]
</span><span id="__span-7-141">    }
</span><span id="__span-7-142">  }
</span><span id="__span-7-143">  checks: {
</span><span id="__span-7-144">    snapshot: {
</span><span id="__span-7-145">      equalTo: [
</span><span id="__span-7-146">        {id: ${SRC}"_row_cnt_chk", metric: ${SRC}"_row_cnt", threshold: 170896055}
</span><span id="__span-7-147">      ]
</span><span id="__span-7-148">    }
</span><span id="__span-7-149">  }
</span><span id="__span-7-150">}
</span></code></pre></div>
<h5 id="distinct-values-metric_3">Distinct values metric</h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1">SRC = "ytd"
</span><span id="__span-8-2">jobConfig: {
</span><span id="__span-8-3">  jobId: "yellow_trip_data"
</span><span id="__span-8-4">  jobDescription: "Data Quality job for NY Taxi Data"
</span><span id="__span-8-5">  sources: {
</span><span id="__span-8-6">    file: [
</span><span id="__span-8-7">      {
</span><span id="__span-8-8">        id: ${SRC},
</span><span id="__span-8-9">        kind: "parquet",
</span><span id="__span-8-10">        path: "/datalake/data/workspace/mlcib/ruadlu/yellow_trip_data"
</span><span id="__span-8-11">        keyFields: ["vendor_name", "trip_pickup_datetime"]
</span><span id="__span-8-12">      }
</span><span id="__span-8-13">    ]
</span><span id="__span-8-14">  }
</span><span id="__span-8-15">  metrics: {
</span><span id="__span-8-16">    regular: {
</span><span id="__span-8-17">      distinctValues: [{id: ${SRC}"_dist_vals", source: ${SRC}, columns: ["trip_distance"]}]
</span><span id="__span-8-18">    }
</span><span id="__span-8-19">  }
</span><span id="__span-8-20">  checks: {
</span><span id="__span-8-21">    snapshot: {
</span><span id="__span-8-22">      equalTo: [
</span><span id="__span-8-23">        {id: ${SRC}"_dist_vals_chk", metric: ${SRC}"_dist_vals", threshold: 6876}
</span><span id="__span-8-24">      ]
</span><span id="__span-8-25">    }
</span><span id="__span-8-26">  }
</span><span id="__span-8-27">}
</span></code></pre></div>
<h5 id="duplicate-values-metric_3">Duplicate values metric</h5>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1">SRC = "ytd"
</span><span id="__span-9-2">jobConfig: {
</span><span id="__span-9-3">  jobId: "yellow_trip_data"
</span><span id="__span-9-4">  jobDescription: "Data Quality job for NY Taxi Data"
</span><span id="__span-9-5">  sources: {
</span><span id="__span-9-6">    file: [
</span><span id="__span-9-7">      {
</span><span id="__span-9-8">        id: ${SRC},
</span><span id="__span-9-9">        kind: "parquet",
</span><span id="__span-9-10">        path: "/datalake/data/workspace/mlcib/ruadlu/yellow_trip_data"
</span><span id="__span-9-11">        keyFields: ["vendor_name", "trip_pickup_datetime"]
</span><span id="__span-9-12">      }
</span><span id="__span-9-13">    ]
</span><span id="__span-9-14">  }
</span><span id="__span-9-15">  metrics: {
</span><span id="__span-9-16">    regular: {
</span><span id="__span-9-17">      duplicateValues: [{
</span><span id="__span-9-18">        id: ${SRC}"_dupl_vals", source: ${SRC}, 
</span><span id="__span-9-19">        columns: [
</span><span id="__span-9-20">          "vendor_name", "trip_pickup_datetime", "trip_dropoff_datetime",
</span><span id="__span-9-21">          "start_lon", "start_lat", "end_lon", "end_lat"
</span><span id="__span-9-22">        ]
</span><span id="__span-9-23">      }]
</span><span id="__span-9-24">    }
</span><span id="__span-9-25">  }
</span><span id="__span-9-26">  checks: {
</span><span id="__span-9-27">    snapshot: {
</span><span id="__span-9-28">      equalTo: [
</span><span id="__span-9-29">        {id: ${SRC}"_dupl_vals_chk", metric: ${SRC}"_dupl_vals", threshold: 34435}
</span><span id="__span-9-30">      ]
</span><span id="__span-9-31">    }
</span><span id="__span-9-32">  }
</span><span id="__span-9-33">}
</span></code></pre></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "toc.follow", "toc.integrate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>