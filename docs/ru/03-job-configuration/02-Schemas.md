# Описание Схем Данных (Schemas)

Схемы данных используются в Data Quality пайплайнах для следующих целей:

* Предоставить явную схему данных для чтения из источников, которые не содержат в себе схему данных, например, тестовые
  файлы (как с разделителем, так и с фиксированной шириной колонки).
* Предоставить мастер-схему для валидации фактической схемы из источника. Так, схемы используются в загрузочной
  проверке `schemaMatch` (см. главу [Schema Match Check](???))

Схема данных описываются в разделе `schemas` файла с конфигурацией Data Quality пайплайна. Схемы могут быть описаны в
различных форматах. Формат, в котором описывается схема, указывается в поле `kind`, и определяет другие поля, которые
должны быть заполнены.

## Описание схемы текстовых файлов с разделителем (Delimited Schema)

Данный тип схем в основном предназначен для чтения текстовых файлов с разделителем, таких CSV или TSV.
Тем не менее эти схемы также могут быть использованы в загрузочных проверках `schemaMatch`. Данных тип конфигурации
схемы позволяет описывать только плоские структуры (вложенные колонки не допускаются).

Итак, описание схемы текстовых файлов с разделителем производится с помощью следующих полей:

* `kind: "delimited"` - *Обязательно*. Устанавливает формат схемы для текстовых файлов с разделителем;
* `id` - *Обязательно*. ID схемы;
* `schema` - *Обязательно*. Список колонок, где каждая колонка - это объект со следующим полями:
    * `name` - *Обязательно*. Имя колонки;
    * `type` - *Обязательно*. Тип колонки. Список поддерживаемых типов дан в главе [Поддерживаемые Наименования Типов](#_1).

## Описание схемы файлов с фиксированной шириной колонки (Fixed-Full Schema)

Данный тип схем используется для того, чтобы читать текстовые файлы без разделителя: с фиксированной шириной колонки.
Основное отличие от схем других типов - это указание ширины каждой колонки (число символов), которое критично для того,
чтобы правильно считывать содержимое таких файлов. Несмотря на специфику, этот тип схем также может быть использован 
для чтения файлов с разделителем и для указания в загрузочных проверках `schemaMatch`. Данных тип конфигурации
схемы позволяет описывать только плоские структуры (вложенные колонки не допускаются).

Итак, описание схемы файлов с фиксированной шириной колонки производится с помощью следующих полей:

* `kind: "fixedFull"` - *Обязательно*. Устанавливает формат схемы для тестовых файлов без разделителя.
* `id` - *Обязательно*. ID схемы;
* `schema` - *Обязательно*. Список колонок, где каждая колонка - это объект со следующим полями:
    * `name` - *Обязательно*. Имя колонки;
    * `type` - *Обязательно*. Тип колонки. Список поддерживаемых типов дан в главе [Поддерживаемые Наименования Типов](#_1).
    * `width` - *Обязательно*. Ширина колонки (целое число символов).

## Упрощенное описание схемы файлов с фиксированной шириной колонки (Fixed-Short Schema)

Данные тип конфигурации предоставляет более простой способ описывать схемы для файлов без разделителя. В данном случае
колонки описываются с указанием только лишь их имени и ширины. *Соответственно, все колонки будут иметь текстовый тип 
данных.* Данный тип схем также может быть использован для чтения файлов с разделителем и для указания в загрузочных 
проверках `schemaMatch`. Данных тип конфигурации схемы позволяет описывать только плоские структуры 
(вложенные колонки не допускаются).

Итак, упрощенное описание схемы файлов без разделителя производится с помощью следующих полей:

* `kind: "fixedShort"` - *Обязательно*. Устанавливает упрощенный формат схемы для тестовых файлов без разделителя.
* `id` - *Обязательно*. ID схемы;
* `schema` - *Обязательно*. Список колонок, где каждая колонка это строка в формате: `columnName:columnWidth`.
  *Колонки всегда имеют текстовый тип.*

## Описание Avro Схемы

Данный тип конфигурации используется для того, чтобы читать Avro схемы из файлов, расширением `.avcs`. Так, схема, 
считанная из такого файла, может быть использована как для чтения Avro-файлов, так и для чтения текстовых файлов с 
разделителем. Также, эти схемы могут быть использованы в загрузочных проверках `schemaMatch`. В дополнение стоит
отметить, что Avro схемы поддерживают сложные структуры со вложенными колонками.

Для того чтобы прочитать Avro схему из файла, необходимо указать следующие параметры:

* `kind: "avro"` - *Обязательно*. Устанавливает формат конфигурации Avro схемы.
* `id` - *Обязательно*. ID схемы;
* `schema` - *Required*. Путь до `.avsc` файла из которого будет считана Avro-схема.

## Описание Hive Схемы

Каталог Hive также может быть использован как источник схем данных. Так, Hive формат описания схем предназначен для
того, чтобы получать схемы данных, которые соответствуют определенным Hive таблицам. Эти схемы могут быть использованы
как для чтения Avro-файлов, так и для чтения текстовых файлов с разделителем. Также, эти схемы могут быть использованы 
в загрузочных проверках `schemaMatch`. В дополнение стоит отметить, что Avro схемы поддерживают сложные структуры 
со вложенными колонками.

Для того чтобы получить схему из Hive каталога, необходимо указать следующие параметры:

* `kind: "hive"` - *Обязательно*. Устанавливает Hive формат описания схемы.
* `id` - *Обязательно*. ID схемы;
* `schema` - *Обязательно*. Hive схема, в которой находится целевая Hive таблица.
* `table` - *Обязательно*. Hive таблица из которой считывается схема.
* `excludeColumns` - *Опционально*. Список колонок, которые будут исключены из схемы. Например, в некоторых ситуациях
  необходимо исключить колонки партиционирования из схемы.

## Поддерживаемые Наименования Типов

Следующие наименования типов могут быть использованы при описании схем данных:

* `string`
* `boolean`
* `date`
* `timestamp`
* `integer (32-bit integer)`
* `long (64-bit integer)`
* `short (16-bit integer)`
* `byte (signed integer in a single byte)`
* `double`
* `float`
* `decimal(precision, scale)` _(precision <= 38; scale <= precision)_

## Пример Описания Схем Данных

Как показано в примере ниже, раздел `schema` представляет собой список конфигураций схем с указанием типов этих 
конфигураций.

```hocon
jobConfig: {
  schemas: [
    {
      id: "schema1"
      kind: "delimited"
      schema: [
        {name: "colA", type: "string"},
        {name: "colB", type: "timestamp"},
        {name: "colC", type: "decimal(10, 3)"}
      ]
    }
    {
      id: "schema2"
      kind: "fixedFull",
      schema: [
        {name: "col1", type: "integer", width: 5},
        {name: "col2", type: "double", width: 6},
        {name: "col3", type: "boolean", width: 4}
      ]
    }
    {id: "schema3", kind: "fixedShort", schema: ["colOne:5", "colTwo:7", "colThree:9"]}
    {id: "hive_schema", kind: "hive", schema: "some_schema", table: "some_table"}
    {id: "avro_schema", kind: "avro", schema: "path/to/avro_schema.avsc"}
  ]
}
```